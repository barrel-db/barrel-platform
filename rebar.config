%% -*- tab-width: 4;erlang-indent-level: 4;indent-tabs-mode: nil -*-
%% ex: ft=erlang ts=4 sw=4 et
%
{erl_opts, [debug_info]}.

{deps, [
    %% Core
    {couch, ".*",
     {git, "https://github.com/rcouch/couch.git",
      {branch, "feature/core"}}},

    {couch_httpd, ".*",
     {git, "https://github.com/rcouch/couch_httpd.git",
      {branch, "feature/core"}}},

    %% Index
    {couch_index, ".*",
     {git, "https://github.com/rcouch/couch_index.git",
      {tag, "1.4.2"}}},

    {couch_mrview, ".*",
     {git, "https://github.com/rcouch/couch_mrview.git",
      {tag, "2.1.1"}}},

    %% CHANGES handlers
    {couch_changes,
     {git, "https://github.com/rcouch/couch_changes.git",
      {tag, "1.1.1"}}},

    {couch_replicator, ".*",
     {git, "https://github.com/rcouch/couch_replicator",
      {tag, "1.7.1"}}},

    {couch_dbupdates, ".*",
     {git, "https://github.com/rcouch/couch_dbupdates",
      {tag, "1.1.0"}}},

    %% Plugins
    {couch_randomdoc, ".*",
     {git, "https://github.com/rcouch/couch_randomdoc",
      {tag, "1.0.1"}}},

    {geocouch, ".*",
     {git, "https://github.com/rcouch/geocouch",
      {tag, "1.0.0"}}},

    {couch_extra, ".*",
     {git, "https://github.com/barrel-db/couch_extra",
      {branch, "master"}}}

]}.

{relx, [
    {release, {'barrel', "1.0.0-alpha-2"},
        [lager,
         sasl,
         public_key,
         ssl,
         crypto,
         os_mon,
         inets,
         runtime_tools,
         mochiweb,
         ibrowse,
         hackney,
         couch_os_process,
         barrel_couchjs,
         couch,
         couch_index,
         couch_httpd,
         couch_mrview,
         couch_changes,
         couch_replicator,
         couch_randomdoc,
         couch_dbupdates,
         couch_extra,
         geocouch]},

    {sys_config, ""},

    {vm_args, ""},

    {dev_mode, true},
    {include_erts, false},
    {extended_start_script, true},

    {overlay_vars, "config/vars.config"},

    {overlay, [
        {mkdir, "log"},
        {mkdir, "run"},
        {mkdir, "data"},

        %% keep empty files
        {copy, "config/empty", "log/KEEP"},
        {copy, "config/empty", "data/KEEP"},


        %% config files
        {template, "config/sys.config", "releases/{{rel_vsn}}//sys.config"},
        {template, "config/vm.args", "releases/{{rel_vsn}}/vm.args"},
        {template, "config/couch.ini", "etc/couch.ini"},
        {template, "config/local.ini", "etc/local.ini"},

        %% couchdb data files
        {mkdir, "share"},
        {copy, "share/www", "share"}

    ]}
]}.

{profiles, [{prod, [{relx, [{dev_mode, false},
                            {include_erts, true}]}]
            }]
}.
